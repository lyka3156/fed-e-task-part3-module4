# 1. 创建项目

``` sh
# 创建gridsome 项目
gridsome create 项目名称

# 安装依赖
cnpm i
```

# 2. 处理首页模板
[html模板](https://github.com/StartBootstrap/startbootstrap-clean-blog)

克隆html模板到本地
``` js
// --depth=1 只下载最后一次历史提交记录
git clone https://github.com/lyka3156/startbootstrap-clean-blog.git --depth=1
```

安装模块
``` js
cnpm i bootstrap
cnpm i @fortawesome/fontawesome-free
```

引入css文件
`src/main.js`
``` js
// 引入插件样式
import "bootstrap/dist/css/bootstrap.min.css"
import "@fortawesome/fontawesome-free/css/all.min.css"

// 引入自己的css
import "./assets/css/index.css"
```

使用html模板
`src/pages/index.vue`
``` vue
<template>
  <div>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand" href="index.html">Start Bootstrap</a>
        <button
          class="navbar-toggler navbar-toggler-right"
          type="button"
          data-toggle="collapse"
          data-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="post.html">Sample Post</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Header -->
    <header class="masthead" style="background-image: url('/img/home-bg.jpg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="site-heading">
              <h1>Clean Blog</h1>
              <span class="subheading">A Blog Theme by Start Bootstrap</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-preview">
            <a href="post.html">
              <h2 class="post-title">
                Man must explore, and this is exploration at its greatest
              </h2>
              <h3 class="post-subtitle">
                Problems look mighty small from 150 miles up
              </h3>
            </a>
            <p class="post-meta">
              Posted by
              <a href="#">Start Bootstrap</a>
              on September 24, 2019
            </p>
          </div>
          <hr />
          <div class="post-preview">
            <a href="post.html">
              <h2 class="post-title">
                I believe every human has a finite number of heartbeats. I don't
                intend to waste any of mine.
              </h2>
            </a>
            <p class="post-meta">
              Posted by
              <a href="#">Start Bootstrap</a>
              on September 18, 2019
            </p>
          </div>
          <hr />
          <div class="post-preview">
            <a href="post.html">
              <h2 class="post-title">Science has not yet mastered prophecy</h2>
              <h3 class="post-subtitle">
                We predict too much for the next year and yet far too little for
                the next ten.
              </h3>
            </a>
            <p class="post-meta">
              Posted by
              <a href="#">Start Bootstrap</a>
              on August 24, 2019
            </p>
          </div>
          <hr />
          <div class="post-preview">
            <a href="post.html">
              <h2 class="post-title">Failure is not an option</h2>
              <h3 class="post-subtitle">
                Many say exploration is part of our destiny, but it’s actually
                our duty to future generations.
              </h3>
            </a>
            <p class="post-meta">
              Posted by
              <a href="#">Start Bootstrap</a>
              on July 8, 2019
            </p>
          </div>
          <hr />
          <!-- Pager -->
          <div class="clearfix">
            <a class="btn btn-primary float-right" href="#"
              >Older Posts &rarr;</a
            >
          </div>
        </div>
      </div>
    </div>

    <hr />

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <ul class="list-inline text-center">
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
            </ul>
            <p class="copyright text-muted">
              Copyright &copy; Your Website 2020
            </p>
          </div>
        </div>
      </div>
    </footer>
  </div>
</template>

<script>
export default {
  metaInfo: {
    title: "Hello, world!",
  },
};
</script>

<style>
</style>
```

# 3. 处理其他页面模块

`src/layouts/Default.vue`
- 抽离公共样式
``` vue
<template>
  <div class="layout">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand" href="index.html">Start Bootstrap</a>
        <button
          class="navbar-toggler navbar-toggler-right"
          type="button"
          data-toggle="collapse"
          data-target="#navbarResponsive"
          aria-controls="navbarResponsive"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          Menu
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="post.html">Sample Post</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="contact.html">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- 子组件出口 默认插槽 -->
    <slot />

    <!-- Footer -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <ul class="list-inline text-center">
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li class="list-inline-item">
                <a href="#">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
            </ul>
            <p class="copyright text-muted">
              Copyright &copy; Your Website 2020
            </p>
          </div>
        </div>
      </div>
    </footer>
  </div>
</template>



<style>
</style>

```
`src/pages/Post.vue`
- 详情
``` vue
<template>
  <Layout>
    <!-- Page Header -->
    <header class="masthead" style="background-image: url('img/post-bg.jpg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="post-heading">
              <h1>Man must explore, and this is exploration at its greatest</h1>
              <h2 class="subheading">
                Problems look mighty small from 150 miles up
              </h2>
              <span class="meta"
                >Posted by
                <a href="#">Start Bootstrap</a>
                on August 24, 2019</span
              >
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Post Content -->
    <article>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <p>
              Never in all their history have men been able truly to conceive of
              the world as one: a single sphere, a globe, having the qualities
              of a globe, a round earth in which all the directions eventually
              meet, in which there is no center because every point, or none, is
              center — an equal earth which all men occupy as equals. The
              airman's earth, if free men make it, will be truly round: a globe
              in practice, not in theory.
            </p>

            <p>
              Science cuts two ways, of course; its products can be used for
              both good and evil. But there's no turning back from science. The
              early warnings about technological dangers also come from science.
            </p>

            <p>
              What was most significant about the lunar voyage was not that man
              set foot on the Moon but that they set eye on the earth.
            </p>

            <p>
              A Chinese tale tells of some men sent to harm a young girl who,
              upon seeing her beauty, become her protectors rather than her
              violators. That's how I felt seeing the Earth for the first time.
              I could not help but love and cherish her.
            </p>

            <p>
              For those who have seen the Earth from space, and for the hundreds
              and perhaps thousands more who will, the experience most certainly
              changes your perspective. The things that we share in our world
              are far more valuable than those which divide us.
            </p>

            <h2 class="section-heading">The Final Frontier</h2>

            <p>
              There can be no thought of finishing for ‘aiming for the stars.’
              Both figuratively and literally, it is a task to occupy the
              generations. And no matter how much progress one makes, there is
              always the thrill of just beginning.
            </p>

            <p>
              There can be no thought of finishing for ‘aiming for the stars.’
              Both figuratively and literally, it is a task to occupy the
              generations. And no matter how much progress one makes, there is
              always the thrill of just beginning.
            </p>

            <blockquote class="blockquote">
              The dreams of yesterday are the hopes of today and the reality of
              tomorrow. Science has not yet mastered prophecy. We predict too
              much for the next year and yet far too little for the next ten.
            </blockquote>

            <p>
              Spaceflights cannot be stopped. This is not the work of any one
              man or even a group of men. It is a historical process which
              mankind is carrying out in accordance with the natural laws of
              human development.
            </p>

            <h2 class="section-heading">Reaching for the Stars</h2>

            <p>
              As we got further and further away, it [the Earth] diminished in
              size. Finally it shrank to the size of a marble, the most
              beautiful you can imagine. That beautiful, warm, living object
              looked so fragile, so delicate, that if you touched it with a
              finger it would crumble and fall apart. Seeing this has to change
              a man.
            </p>

            <a href="#">
              <img class="img-fluid" src="img/post-sample-image.jpg" alt="" />
            </a>
            <span class="caption text-muted"
              >To go places and do things that have never been done before –
              that’s what living is all about.</span
            >

            <p>
              Space, the final frontier. These are the voyages of the Starship
              Enterprise. Its five-year mission: to explore strange new worlds,
              to seek out new life and new civilizations, to boldly go where no
              man has gone before.
            </p>

            <p>
              As I stand out here in the wonders of the unknown at Hadley, I
              sort of realize there’s a fundamental truth to our nature, Man
              must explore, and this is exploration at its greatest.
            </p>

            <p>
              Placeholder text by
              <a href="http://spaceipsum.com/">Space Ipsum</a>. Photographs by
              <a href="https://www.flickr.com/photos/nasacommons/"
                >NASA on The Commons</a
              >.
            </p>
          </div>
        </div>
      </div>
    </article>
  </Layout>
</template>

<script>
export default {
  name: "PostPage",
};
</script>

<style>
</style>
```
`src/pages/About.vue`
- 关于
``` vue
<template>
  <Layout>
    <!-- Page Header -->
    <header class="masthead" style="background-image: url('img/about-bg.jpg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="page-heading">
              <h1>About Me</h1>
              <span class="subheading">This is what I do.</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Saepe
            nostrum ullam eveniet pariatur voluptates odit, fuga atque ea nobis
            sit soluta odio, adipisci quas excepturi maxime quae totam ducimus
            consectetur?
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eius
            praesentium recusandae illo eaque architecto error, repellendus
            iusto reprehenderit, doloribus, minus sunt. Numquam at quae
            voluptatum in officia voluptas voluptatibus, minus!
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aut
            consequuntur magnam, excepturi aliquid ex itaque esse est vero natus
            quae optio aperiam soluta voluptatibus corporis atque iste neque sit
            tempora!
          </p>
        </div>
      </div>
    </div>
  </Layout>
</template>

<script>
export default {
  metaInfo: {
    title: "About us",
  },
  name: "AboutPage",
};
</script>

```
`src/pages/Contact` 
- 联系我们
``` vue
<template>
  <Layout>
    <!-- Page Header -->
    <header
      class="masthead"
      style="background-image: url('img/contact-bg.jpg')"
    >
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="page-heading">
              <h1>Contact Me</h1>
              <span class="subheading">Have questions? I have answers.</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <p>
            Want to get in touch? Fill out the form below to send me a message
            and I will get back to you as soon as possible!
          </p>
          <!-- Contact Form - Enter your email address on line 19 of the mail/contact_me.php file to make this form work. -->
          <!-- WARNING: Some web hosts do not allow emails to be sent through forms to common mail hosts like Gmail or Yahoo. It's recommended that you use a private domain email address! -->
          <!-- To use the contact form, your site must be on a live web host with PHP! The form will not work locally! -->
          <form name="sentMessage" id="contactForm" novalidate>
            <div class="control-group">
              <div class="form-group floating-label-form-group controls">
                <label>Name</label>
                <input
                  type="text"
                  class="form-control"
                  placeholder="Name"
                  id="name"
                  required
                  data-validation-required-message="Please enter your name."
                />
                <p class="help-block text-danger"></p>
              </div>
            </div>
            <div class="control-group">
              <div class="form-group floating-label-form-group controls">
                <label>Email Address</label>
                <input
                  type="email"
                  class="form-control"
                  placeholder="Email Address"
                  id="email"
                  required
                  data-validation-required-message="Please enter your email address."
                />
                <p class="help-block text-danger"></p>
              </div>
            </div>
            <div class="control-group">
              <div
                class="form-group col-xs-12 floating-label-form-group controls"
              >
                <label>Phone Number</label>
                <input
                  type="tel"
                  class="form-control"
                  placeholder="Phone Number"
                  id="phone"
                  required
                  data-validation-required-message="Please enter your phone number."
                />
                <p class="help-block text-danger"></p>
              </div>
            </div>
            <div class="control-group">
              <div class="form-group floating-label-form-group controls">
                <label>Message</label>
                <textarea
                  rows="5"
                  class="form-control"
                  placeholder="Message"
                  id="message"
                  required
                  data-validation-required-message="Please enter a message."
                ></textarea>
                <p class="help-block text-danger"></p>
              </div>
            </div>
            <br />
            <div id="success"></div>
            <button
              type="submit"
              class="btn btn-primary"
              id="sendMessageButton"
            >
              Send
            </button>
          </form>
        </div>
      </div>
    </div>
  </Layout>
</template>

<script>
export default {
  name: "ContactPage",
};
</script>

<style>
</style>
```

# 4. 使用本地md文件管理文章内容
[使用markdown文件](https://gridsome.org/docs/fetching-data/#markdown)

使用[@gridsome/source-filesystem](https://gridsome.org/plugins/@gridsome/source-filesystem)充当gridsome的数据

安装插件
``` js
cnpm i @gridsome/source-filesystem -S
```

配置插件
`gridsome.config.js`
``` js
plugins: [{
    use: '@gridsome/source-filesystem',
    options: {
        typeName: 'BlogPost',     // 数据类型
        path: './content/blog/**/*.md', // 从哪里抓取mk文件
    }
}]
```

还需要一个转换器将mk文件转换成html
``` js
cnpm i @gridsome/transformer-remark -S
```

# 5. Strapi(cms后台管理系统) 介绍  
[strapi官网](https://strapi.io/)
  - [doc文档说明](https://strapi.io/documentation/developer-docs/latest/getting-started/introduction.html)

是通用的内容管理系统，通过它可以帮我们轻松的去实现内容管理
- 管理文章
- 管理商品
- 管理用户
- 管理用户的评论

[特点](https://strapi.io/documentation/developer-docs/latest/getting-started/introduction.html#features)：
- 自定义内容结构 (表的增删改查)
- 简单的内容管理
- 开发者的api (Friendly API,Reflu API...)
- 内置用户系统
  - 角色和权限的管理
- 插件扩展功能
  - 构建集合（表结构）
- 自定义项目源代码

## 5.1 Quick Start Guide(快速开始)
[快速开始](https://strapi.io/documentation/developer-docs/latest/getting-started/quick-start.html#_1-install-strapi-and-create-a-new-project)

安装 strapi 并且创建一个项目
``` js
// 默认是 sqlServer数据库
npx create-strapi-app my-project --quickstart
```

## 5.2 使用 Strapi 接口数据
[使用Strapi接口数据](https://strapi.io/documentation/developer-docs/latest/content-api/api-endpoints.html)

`获取实体集合(Get entries)`
``` js
// resquest
GET http://localhost:1337/restaurants
// response
[
  {
    "id": 1,
    "name": "Restaurant 1",
    "cover": {
      "id": 1,
      "name": "image.png",
      "hash": "123456712DHZAUD81UDZQDAZ",
      "sha256": "v",
      "ext": ".png",
      "mime": "image/png",
      "size": 122.95,
      "url": "http://localhost:1337/uploads/123456712DHZAUD81UDZQDAZ.png",
      "provider": "local",
      "provider_metadata": null,
      "created_at": "2019-12-09T00:00:00.000Z",
      "updated_at": "2019-12-09T00:00:00.000Z"
    },
    "content": [
      {
        "__component": "content.title-with-subtitle",
        "id": 1,
        "title": "Restaurant 1 title",
        "subTitle": "Cozy restaurant in the valley"
      },
      {
        "__component": "content.image-with-description",
        "id": 1,
        "image": {
          "id": 1,
          "name": "image.png",
          "hash": "123456712DHZAUD81UDZQDAZ",
          "sha256": "v",
          "ext": ".png",
          "mime": "image/png",
          "size": 122.95,
          "url": "http://localhost:1337/uploads/123456712DHZAUD81UDZQDAZ.png",
          "provider": "local",
          "provider_metadata": null,
          "created_at": "2019-12-09T00:00:00.000Z",
          "updated_at": "2019-12-09T00:00:00.000Z"
        },
        "title": "Amazing photography",
        "description": "This is an amazing photography taken..."
      }
    ],
    "opening_hours": [
      {
        "id": 1,
        "day_interval": "Tue - Sat",
        "opening_hour": "7:30 PM",
        "closing_hour": "10:00 PM"
      }
    ]
  }
]
```

`获取单个实体(Get an entry)`
```js
// request
GET http://localhost:1337/restaurants/1
// response
{
  "id": 1,
  "title": "Restaurant 1",
  "cover": {
    "id": 1,
    "name": "image.png",
    "hash": "123456712DHZAUD81UDZQDAZ",
    "sha256": "v",
    "ext": ".png",
    "mime": "image/png",
    "size": 122.95,
    "url": "http://localhost:1337/uploads/123456712DHZAUD81UDZQDAZ.png",
    "provider": "local",
    "provider_metadata": null,
    "created_at": "2019-12-09T00:00:00.000Z",
    "updated_at": "2019-12-09T00:00:00.000Z"
  },
  "content": [
    {
      "__component": "content.title-with-subtitle",
      "id": 1,
      "title": "Restaurant 1 title",
      "subTitle": "Cozy restaurant in the valley"
    },
    {
      "__component": "content.image-with-description",
      "id": 1,
      "image": {
        "id": 1,
        "name": "image.png",
        "hash": "123456712DHZAUD81UDZQDAZ",
        "sha256": "v",
        "ext": ".png",
        "mime": "image/png",
        "size": 122.95,
        "url": "http://localhost:1337/uploads/123456712DHZAUD81UDZQDAZ.png",
        "provider": "local",
        "provider_metadata": null,
        "created_at": "2019-12-09T00:00:00.000Z",
        "updated_at": "2019-12-09T00:00:00.000Z"
      },
      "title": "Amazing photography",
      "description": "This is an amazing photography taken..."
    }
  ],
  "opening_hours": [
    {
      "id": 1,
      "day_interval": "Tue - Sat",
      "opening_hour": "7:30 PM",
      "closing_hour": "10:00 PM"
    }
  ]
}
```
`获取总数量(Count entries)`
``` js
// requset
GET http://localhost:1337/restaurants/count
// response
1
```
`创建实体(Create an entry)`
``` js
// requset
POST http://localhost:1337/restaurants
{
 ...单个实体对象
}
// response
{
 ...单个实体对象
}
```
`修改实体(Update an entry)`
``` js
// requset
PUT http://localhost:1337/restaurants/1
{
 ...单个实体对象
}
// response
{
 ...单个实体对象
}
```
`删除实体(Delete an entry)`
``` js
// requset
DELETE http://localhost:1337/restaurants/1
// response
{
  ...单个实体
}
```

## 5.3 访问受保护的API
role角色表 (有哪些权限)
- Authenticated 角色有所有功能的权限
- public 只有查询的权限

user用户表 (有哪些用户)
- lyk 

如何登录 strapi
[登录strapi](https://strapi.io/documentation/developer-docs/latest/plugins/users-permissions.html#login)

`登录接口`
``` js
import axios from 'axios';

// Request API.
axios
  .post('http://localhost:1337/auth/local', {
    identifier: 'strapi的用户名或者邮箱',
    password: 'strapi的密码',
  })
  .then(response => {
    // Handle success.
    console.log('Well done!');
    console.log('User profile', response.data.user);
    // 返回jwt的token
    console.log('User token', response.data.jwt);
  })
  .catch(error => {
    // Handle error.
    console.log('An error occurred:', error.response);
});
```
`通过jwt返回的token去访问strapi接口`
[token使用案例](https://strapi.io/documentation/developer-docs/latest/plugins/users-permissions.html#token-usage)
``` js
import axios from 'axios';

// 这个token就是strapi登录之后返回的token
const token = 'YOUR_TOKEN_HERE';

// Request API.
axios
  .get('http://localhost:1337/posts', {
    headers: {
      // 请求头
      Authorization: `Bearer ${token}`,
    },
  })
  .then(response => {
    // Handle success.
    console.log('Data: ', response.data);
  })
  .catch(error => {
    // Handle error.
    console.log('An error occurred:', error.response);
});
```

## 5.4 使用GraphQL方式访问strapi的接口
[参考文献](https://strapi.io/documentation/developer-docs/latest/plugins/graphql.html#graphql)

在strapi项目中安装graphql
``` js
npm run strapi install graphql
```

安装完之后就可以通过下面的链接去访问strapi的数据
- `http://localhost:1337/graphql`链接去访问graphQl方式的的strapi的数据
``` js
// graphQl查询strapi的post实体的数据
query {
  posts {
    id,
    title,
    content
  }

   post(id:1){
    id,
    content,
    title
  }
}
```

## 5.5 将strapi的graphQL方式查询的数据集成到gridsome中
使用[@gridsome/source-strapi](https://gridsome.org/plugins/@gridsome/source-strapi)去集成strapi中的数据到gridsome中

> Strapi source for Gridsome

`Install安装`
``` js
cnpm install @gridsome/source-strapi -s
```

`Usage使用`
``` js
export default {
  plugins: [
    // 将strapi中的数据配置到gridsome中
    {
      use: '@gridsome/source-strapi',
      options: {
        apiURL: 'http://localhost:1337',
        queryLimit: 1000, // (最多查询条数)
        contentTypes: ['post'], // 查询的实体
        // singleTypes: ['impressum'], // 单个节点类型
        // Possibility to login with a Strapi user,
        // when content types are not publicly available (optional).
        // 莫些数据受保护的，需要登录
        // loginData: {
        //   identifier: '',
        //   password: ''
        // }
      }
    }
  ]
}
```
`在gridsome中使用strapi的数据` 
- http://localhost:8080/___explore
``` js
query {
  // 查询多个
  // allStrapiPost {
  //   edges{
  //     node{
  //       id,
  //   		title,
  //   		content
  //     }
  //   }
  // }
  // 查询单个
  strapiPost(id:1){
    id,
    content,
    title
  }
}
```
## 5.6 设计文章和标签数据模型

`post实体 (文章)`
- title   文件的标题
  - 文本类型
  - 必须的
- content 内容
  - 文本编辑器
  - 必须的
- cover 封面
  - 媒体图片
    - 单一媒体(图片)
  - images (只能是图片)
- is_public 发布状态
  - 布尔类型
  - 默认false
  - 必须的

`tag实体(标签)`
- title (标签的名称)
  - 文本类型
  - 必须的
- posts (对应多个标签实体)
  - 引用类型    引用post的tags多对多的关系

`查询文章post`
``` js
query{
  // 查询文章
  post(id:1){
    id,
    content,
    title,
    // 查询文章属于哪个标签
    tags{
      id,
      title
    }
  }
}
```
`查询标签tag`
``` js
query{
  // 查询标签
  tags{
    id,
    title,
    // 查询标签下的文章
    posts{
      title
    }
  }
}
```


# 6. gridsome中展示文章列表
`查询文章列表`
``` js
query {
  allStrapiPost {
    edges{
      node{
        id,
    		title,
        content,
        tags{
          id,
          title
        }
      }
    }
  }
}
```
`src/pages/index.vue`
``` vue
<template>
  <Layout>
    <!-- Page Header -->
    <header class="masthead" style="background-image: url('/img/home-bg.jpg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="site-heading">
              <h1>Clean Blog</h1>
              <span class="subheading">A Blog Theme by Start Bootstrap</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div
            class="post-preview"
            v-for="edge in $page.posts.edges"
            :key="edge.node.id"
          >
            <a href="post.html">
              <h2 class="post-title">
                {{ edge.node.title }}
              </h2>
              <h3 class="post-subtitle">
                {{ edge.node.content }}
              </h3>
            </a>
            <p class="post-meta">
              Posted by
              <a href="#">lyk</a>
              on {{ edge.node.created_at }}
            </p>
            <!-- 标签 -->
            <p>
              <span v-for="tag in edge.node.tags" :key="tag.id">
                <a href="">
                  {{ tag.title }}
                </a>
                &nbsp; &nbsp;
              </span>
            </p>
          </div>
          <hr />
          <hr />
          <!-- Pager -->
          <div class="clearfix">
            <a class="btn btn-primary float-right" href="#"
              >Older Posts &rarr;</a
            >
          </div>
        </div>
      </div>
    </div>
  </Layout>
</template>

<page-query>
query {
  posts: allStrapiPost {
    edges {
      node {
        id,
    		title,
        content,
        created_at,
        tags {
          id,
          title
        }
      }
    }
  }
}
</page-query>

<script>
export default {
  metaInfo: {
    title: "Hello, world!",
  },
  name: "HomePage",
};
</script>

<style>
</style>
```

# 7. 文章列表分页
[参考文献](https://gridsome.org/docs/pagination/)

`分页graphQl`
- Place the `@paginate` directive after the collection you want to paginate.
``` js
// 路劲传递页数
http://localhost:8080/2

// graphQl
<page-query>
query($page: Int) {
  // prePage每页显示几条  
  // $page当前查询的页数
  posts: allStrapiPost(perPage: 2, page: $page) @paginate {
    pageInfo {
      totalPages  // 总条数
      currentPage // 当前显示条数
    }
    edges {
      node {
        id,
    		title,
        content,
        created_at,
        tags {
          id,
          title
        }
      }
    }
  }
}
</page-query>
```

`Pager component(页码分页按钮)`
[参考文献](https://gridsome.org/docs/pagination/#pager-component)
``` js
<template>
  <Layout>
    <ul>
      <li v-for="edge in $page.allBlogPost.edges" :key="edge.node.id">
        {{ edge.node.title }}
      </li>
    </ul>
    <Pager :info="$page.allBlogPost.pageInfo"/>
  </Layout>
</template>

<script>
import { Pager } from 'gridsome'

export default {
  components: {
    Pager
  }
}
</script>

<page-query>
query ($page: Int) {
  allBlogPost(perPage: 10, page: $page) @paginate {
    pageInfo {
      totalPages
      currentPage
    }
    edges {
      node {
        id
        title
      }
    }
  }
}
</page-query>
```
# 8. 展示文章详情
配置文章详情模板
``` js
// 配置模板组件 (这里配置的组件会被打包生成静态页面)
templates: {
  // 内容类型 = plugins中的typeName+contentTypes
  StrapiPost: [{
    path: "/post/:id", // 文章详情路劲
    component: "./src/templates/Post.vue" // 通过这个模板生成静态页面了
  }],
}
```

graphQl语句
``` js
// ID!不能为空
<page-query>
post : query($id:ID!){
   strapiPost(id:$id){
    id,
    title,
    content,
    cover{
      url
    },
    tags{
      id,
      title
    }
  }
}
</page-query>
```

`src/templates/Post.vue`
``` vue
<template>
  <Layout>
    <!-- Page Header -->
    <header
      class="masthead"
      :style="{
        backgroundImage: `url(http://localhost:1337${$page.post.cover.url})`,
      }"
    >
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="post-heading">
              <h1>{{ $page.post.title }}</h1>
              <!-- <h2 class="subheading">
                Problems look mighty small from 150 miles up
              </h2> -->
              <span class="meta"
                >Posted by
                <a href="#">lyk</a>
                {{ $page.post.created_at }}</span
              >
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Post Content -->
    <article>
      <div class="container">
        <div class="row">
          <div
            class="col-lg-8 col-md-10 mx-auto"
            v-html="$page.post.content"
          ></div>
        </div>
      </div>
    </article>
  </Layout>
</template>

<page-query>
query($id:ID!){
   post: strapiPost(id:$id){
    id,
    title,
    content,
    created_at,
    cover{
      url
    },
    tags{
      id,
      title,
    }
  }
}
</page-query>

<script>
export default {
  name: "PostPage",
};
</script>

<style>
</style>
```

# 9. 处理MarkDown格式的文件
借助[markdown-it](https://github.com/markdown-it/markdown-it)插件来实现

安装
``` js
cnpm install markdown-it --save
```

使用
``` vue
<script>
import MarkdownIt from "markdown-it";
const md = new MarkdownIt();
export default {
  name: "PostPage",
  // 将markdown文件转换成html
  methods: {
    mdToHtml(markdown) {
      return md.render(markdown);
    },
  },
};
</script>
```

# 10. 文章标签
配置tag模板
`gridsome.config.js`
``` js
module.exports = {
  siteName: 'Gridsome',
  plugins: [
    // 将strapi中的数据配置到gridsome中
    {
      use: '@gridsome/source-strapi',
      options: {
        apiURL: 'http://localhost:1337',
        queryLimit: 1000, // (最多查询条数)
        contentTypes: ['post', 'tag'], // 查询的实体
        // typeName:"Strapi",   // 类型名称默认Strapi
        // singleTypes: ['impressum'], // 单个节点类型
        // Possibility to login with a Strapi user,
        // when content types are not publicly available (optional).
        // 莫些数据受保护的，需要登录
        // loginData: {
        //   identifier: '',
        //   password: ''
        // }
      }
    }
  ],
  // 配置模板组件 (这里配置的组件会被打包生成静态页面)
  templates: {
    StrapiTag: [
      {
        path: "/tag/:id", // 文章详情路劲
        component: "./src/templates/Tag.vue" // 通过这个模板生成静态页面了
      }
    ]
  }
}
```

`graphQl`
``` js
<page-query>
query($id: ID!){
    tag : strapiTag(id:$id){
        id,
        title,
        posts{
            id,
            title
        }
    }
}
</page-query>
```

`src/templates/Tag.vue`
``` vue
<template>
  <Layout>
    <!-- Page Header -->
    <header class="masthead" style="background-image: url('/img/home-bg.jpg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="site-heading">
              <h1># {{ $page.tag.title }}</h1>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div
            class="post-preview"
            v-for="post in $page.tag.posts"
            :key="post.id"
          >
            <g-link :to="`/post/${post.id}`">
              <h2 class="post-title">
                {{ post.title }}
              </h2>
              <!-- <h3 class="post-subtitle">
                {{ post.node.content }}
              </h3> -->
            </g-link>
            <hr />
            <!-- <p class="post-meta">
              Posted by
              <a href="#">lyk</a>
              on {{ post.node.created_at }}
            </p>
            <p>
              <span v-for="tag in post.node.tags" :key="tag.id">
                <g-link :to="`/tag/${tag.id}`">
                  {{ tag.title }}
                </g-link>
                &nbsp; &nbsp;
              </span>
            </p> -->
          </div>
        </div>
      </div>
    </div>
  </Layout>
</template>

<page-query>
query($id: ID!){
    tag : strapiTag(id:$id){
        id,
        title,
        posts{
            id,
            title
        }
    }
}
</page-query>
<script>
export default {};
</script>

<style>
</style>
```

## 11. 基本设置
配置单个单个节点类型
`gridsome.config.js`
``` js
module.exports = {
  siteName: 'Gridsome',
  plugins: [
    // 将strapi中的数据配置到gridsome中
    {
      use: '@gridsome/source-strapi',
      options: {
        apiURL: 'http://localhost:1337',
        queryLimit: 1000, // (最多查询条数)
        // 查询strapi集合的
        contentTypes: ['post', 'tag'], // 查询的实体
        // typeName:"Strapi",   // 类型名称默认Strapi
        // 查询strapi单个节点的
        singleTypes: ['general'], // 单个节点类型
      }
    }
  ],
}
```
`graphQl`
``` js
general : allStrapiGeneral{
    edges{
      node{
        id,
        title,
        subtitle,
        cover{
          url
        }
      }
    }
}
```
`src/pages/index.vue`
``` vue
<template>
  <Layout>
    <!-- Page Header -->
    <header
      class="masthead"
      :style="{
        backgroundImage: `url(http://localhost:1337${general.cover.url})`,
      }"
    >
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="site-heading">
              <h1>{{ general.title }}</h1>
              <span class="subheading">{{ general.subtitle }}</span>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div
            class="post-preview"
            v-for="edge in $page.posts.edges"
            :key="edge.node.id"
          >
            <g-link :to="`/post/${edge.node.id}`">
              <h2 class="post-title">
                {{ edge.node.title }}
              </h2>
              <!-- <h3 class="post-subtitle">
                {{ edge.node.content }}
              </h3> -->
            </g-link>
            <p class="post-meta">
              Posted by
              <a href="#">lyk</a>
              on {{ edge.node.created_at }}
            </p>
            <!-- 标签 -->
            <p>
              <span v-for="tag in edge.node.tags" :key="tag.id">
                <g-link :to="`/tag/${tag.id}`">
                  {{ tag.title }}
                </g-link>
                &nbsp; &nbsp;
              </span>
            </p>
          </div>
          <hr />
          <hr />
          <!-- Pager -->
          <!-- <div class="clearfix">
            <a class="btn btn-primary float-right" href="#"
              >Older Posts &rarr;</a
            >
          </div> -->
          <Pager :info="$page.posts.pageInfo" />
        </div>
      </div>
    </div>
  </Layout>
</template>

<page-query>
query($page: Int) {
  posts: allStrapiPost(perPage: 2, page: $page,order:ASC) @paginate {
    pageInfo {
      totalPages
      currentPage
    }
    edges{
      node{
        id,
    		title,
        content,
        tags{
          id,
          title
        },
        created_at,
      }
    }
  }

  general : allStrapiGeneral{
    edges{
      node{
        id,
        title,
        subtitle,
        cover{
          url
        }
      }
    }
  }
}
</page-query>

<script>
// 引入Pager页面组件
import { Pager } from "gridsome";
export default {
  metaInfo: {
    title: "Hello, world!",
  },
  name: "HomePage",
  components: {
    Pager,
  },
  computed: {
    general() {
      return this.$page.general.edges[0].node;
    },
  },
};
</script>

<style>
</style>

```


## 12. 联系我们

## 13. 部署
